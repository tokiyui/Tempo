<html>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<head>
<title>海上実況確認用</title>
<style type="text/css">
body{
	font-family: "Hiragino Sans W3", "Hiragino Kaku Gothic ProN", "ヒラギノ角ゴ ProN W3", "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
}
table{
border-collapse: collapse;
}
#blue{
background-color: blue;
color: white;
}
#yellow{
background-color: yellow;
}
#orange{
background-color: orange;
}
#orangered{
background-color: orangered;
}
#darkred{
background-color: darkred;
color: white;
}
#harotable td,th{
text-align: center;
font-size: 15px;
border: 1px solid black;
}
th{
background-color: gray;
color:white;
}
#titenname{
text-align: center;
width:130px;
font-weight: bold;
}

</style>
<script type="text/javascript">

var element;	//表示中の要素
	
	renewAll();

function renewAll(){
	nowphas();
	harodraw();
	switch(element){
		case "toudai": toudai(); break;
		case "chouiE": chouiE(); break;
		case "chouiW": chouiW(); break;
	}
}

/*-------------
	灯台、潮位
-------------*/

function resetToudaiChoui(){
	$('#toudai div').empty();
	$('#chouiContents').empty();
}

//灯台一覧表示
function toudai(){
	element = "toudai";
	resetToudaiChoui();
	var timemin = new Date();
	var nocache = "?" + timemin.getDay() + timemin.getHours() + timemin.getMinutes();

	$('#t1').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/09kanku/niigata/hajikisaki_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/234_fuusoku.gif"+nocache +"\"/></a>");
  $('#t2').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/09kanku/nanao/hegurashima_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/233_fuusoku.gif"+nocache +"\"/></a>");
  $('#t3').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/09kanku/niigata/sawasakihana_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/235_fuusoku.gif"+nocache +"\"/></a>");
  $('#t4').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/09kanku/niigata/torigakubimisaki_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/236_fuusoku.gif"+nocache +"\"/></a>");
  $('#t5').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/09kanku/fushiki/fushiki_dl/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/237_fuusoku.gif"+nocache +"\"/></a>");
  $('#t6').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/08kanku/tsuruga/echizenmisaki_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/230_fuusoku.gif"+nocache +"\"/></a>");
  $('#t7').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/08kanku/tsuruga/tateishimisaki_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/231_fuusoku.gif"+nocache +"\"/></a>");
  $('#t8').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/08kanku/maizuru/kyogamisaki_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/224_fuusoku.gif"+nocache +"\"/></a>");
  $('#t9').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/02kanku/sakata/tobishima_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/157_fuusoku.gif"+nocache +"\"/></a>");
  $('#t10').append("<a target=\"_blank\" href=\"http://www6.kaiho.mlit.go.jp/02kanku/akita/akita_n_bkw_lt/kisyou/index.html"+nocache +"\"><img style=\"position:absolute;clip:auto\" height=\"125\" src=\"http://www6.kaiho.mlit.go.jp/kishogenkyo/graphs/156_fuusoku.gif"+nocache +"\"/></a>");
	
	$('#t1s').html("弾埼灯台");
	$('#t2s').html("舳倉島灯台");
	$('#t3s').html("沢崎鼻灯台");
	$('#t4s').html("鳥ヶ首灯台");
	$('#t5s').html("伏木指向灯台");
	$('#t6s').html("越前岬灯台");
	$('#t7s').html("立石岬灯台");
	$('#t8s').html("経ヶ岬灯台");
	$('#t9s').html("飛島灯台");
	$('#t10s').html("秋田北防波堤灯台");
	
 }

//東部潮位表示（更新）
function chouiE(){
	element = "chouiE";
	var observs={
		"鼠ヶ関[国土地理院]": 113502,
		"粟島[海上保安庁]": 145412,
		"佐渡[気象庁]": 145404,
		"新潟東港[港湾局]": 145408,
		"新潟西港[港湾局]": 145481,
		"小木[国土地理院]": 145406,
		"柏崎[国土地理院]": 145402,
		"上越市直江津（臨時）[気象庁]": 145413
	};
	choui(observs);
}

//西部潮位表示（更新）
function chouiW(){
	element = "chouiW"
	var observs={
		"生地[水管理・国土保全局]": 145502,
		"富山[気象庁]": 145501,
		"新湊[港湾局]": 145503,
		"伏木富山[港湾局]": 145553,
		"七尾[港湾局]": 145651,
		//"能登[気象庁]": 145601,
		"珠洲市飯田(臨時)[気象庁]": 145607,
		//"輪島港[港湾局]": 145605,
		"輪島港(臨時)[港湾局]": 145606,
		"輪島[国土地理院]": 145602,
		"金沢[港湾局]": 145681,
		"三国[国土地理院]": 145701,
		"敦賀[港湾局]": 145751,
		"舞鶴[気象庁]": 156101
	};
	choui(observs);
}

/*
以前のバージョンの地点。不要？
function choui0(){
	var observs={
		"金沢[港湾局]": 145681,
		"新潟西港[港湾局]": 145481,
		"佐渡[気象庁]": 145404,
		"能登[気象庁]": 145601,
		"富山[気象庁]": 145501,
		"敦賀[港湾局]": 145751
	};
	choui(observs);
}
*/

//引数に応じた潮位を表示
function choui(observs){
	resetToudaiChoui();
	
	var timemin = new Date();
	var year =timemin.getFullYear();
	var month =timemin.getMonth()+1;
	if(month< 10){
	var mon = "0" + month;
	}else{
	var mon =  month;
	}
	if(timemin.getDate() < 10){
	var day = "0" + timemin.getDate();
	}else{
	var day =  timemin.getDate();
	}
	var nocache = "?" + timemin.getDay() + timemin.getHours() + timemin.getMinutes();
	
	var trTag = $("<tr></tr>");
	var tdCount = 0;
	$.each(observs,function(name, number) {
		trTag.append("<td>" + name + "<br>" + 
				"<a href=\"http://ksmnp02.shiok.naps.kishou.go.jp/~kaijoul1/Coast_Hazard/tide/Rtn/tide_info/tpdata/TIDE_SHORT_HEIGHT_"+number+".png"+nocache +"\">" + 
				"<img height=\"230\" src=\"http://ksmnp02.shiok.naps.kishou.go.jp/~kaijoul1/Coast_Hazard/tide/Rtn/tide_info/tpdata/TIDE_SHORT_HEIGHT_"+number+".png"+nocache +"\">" + 
				"</a></td>");
		tdCount++;
		if(tdCount == 4){
			$('#chouiContents').append(trTag);
			trTag = $("<tr></tr>");
			tdCount = 0;
		}
	});
	if(tdCount>0){
		$('#chouiContents').append(trTag);
	}
 	
 	$('#gallery a').lightBox({overlayBgColor:'#D3D3D3' });
}

/*-----------------
		ナウファス
-----------------*/

//波浪更新
function nowphas(){
	var env_observ={
		"能代港": 123,
		"秋田港": 101,
		"酒田港": 124,
		"山形県沖": 808,
		"新潟港": 112,
		"直江津港": 114,
		"伏木富山港富山": 115,
		"伏木富山港伏木": 113,
		"輪島港": 105,
		"金沢港": 106,
		"福井港": 117,
		"敦賀港": 122,
		"柴山港": 310,
		"鳥取港": 304
	};
		getNowphas(number, name);
		setHover(number, name);
	});
}

// 波浪時系列をポップアップする
function setHover(number, name){
	var baseUrl="http://nowphas.mlit.go.jp/sp/yg_graphimg/";
	var imgUrl=baseUrl + number+"_" + getYmd()+ ".png";
}
	
function getYmd(){
	var delay=60; // データがアップされるまでの時間を考慮
	var date=new Date();
	date.setMinutes(date.getMinutes() - delay);
	return date.getFullYear() + 
					("0"+(date.getMonth()+1)).slice(-2) + 
					("0"+date.getDate()).slice(-2) 
}
// ナウファスのページから、各地点の最新データを取得する
function getNowphas(number, name){
	var url="http://nowphas.mlit.go.jp/sp/pg_yugiha/"+number+"/";
	//var url="http://nowphas.mlit.go.jp/sp/pg_yugiha/"+number+"/" + getYmd();
	$.ajax({
		url:"./getContents/getContentsBugai.php",
		dataType:"text",
		data: { url: url },
		//async:false,
		success:function(xml){
			var data=parseHtml(xml);
			$("#" + number).append(data);
			checkValue(number);
		},
		error:function(seq, status, error){
			$('#kaihoErrorMessage').append("<div>" + name + "&ensp;" + seq.status+"&ensp;"+status+"&ensp;"+error + "</div>");
			//alert(seq.status+"\n"+status+"\n"+error);
		}
	});
}
// データを解析する(元ページの仕様が変わった場合はここを修正してください)
function parseHtml(text){
	// HTMLをそのままDOMにしようとしても無理っぽいので、ガワとなる　contents　タグを用意する
	var xml=$.parseHTML("<contents></contents>");
	// 作ったガワに、もらってきたHTMLを流し込む
	$(xml).append($.parseHTML(text));
	var str="";
	// 要素を探す
	$(xml).find("tr").each(function(){
		$(this).find("td:eq(0)").each(function(){ // 波高値はtdタグの０番目にある
			var value=$(this).text();
			// 最下段の最大値には m が入っているから除去 !value.match(/m/)
			// まだ入電していない時間帯は除去 value!=""
			// 欠測の **** も除去 value!="****"
			// 最下段の波向値を除去 !value.match(/[A-Z])
			if(!value.match(/m/) && !value.match(/秒/) && value!="" && value!="****" && !value.match(/[A-Z]/) ){
				// データがある部分上書きしていく
				str="<td>" + $(this).parent().find("th:eq(0)").text() + "</td><td>" + value+"</td><td>" +  $(this).parent().find("td:eq(1)").text()  + "</td><td>" +  $(this).parent().find("td:eq(2)").text()  + "</td>";
			}
		});
	});
	$(xml).find("tr").each(function(){
		$(this).find("td:eq(4)").each(function(){ // 波高値はtdタグの4番目にもある
			var value=$(this).text();
			// 最下段の最大値には m が入っているから除去 !value.match(/m/)
			// まだ入電していない時間帯は除去 value!=""
			// 欠測の **** も除去 value!="****"
			// 最下段の波向値を除去 !value.match(/[A-Z])
			if(!value.match(/m/) && !value.match(/秒/) && value!="" && value!="****" && !value.match(/[A-Z]/) ){
				// データがある部分上書きしていく
				str="<td>" + $(this).parent().find("td:eq(3)").text() + "</td><td>" + value+"</td><td>" +  $(this).parent().find("td:eq(5)").text()  + "</td><td>" +  $(this).parent().find("td:eq(6)").text()  + "</td>";
			}
		});
	});
	// 最終的に残ったやつが最新の観測値
	if(str=="")str="<td>-</td><td>-</td><td>-</td><td>-</td>";
	return str;
}

//色をつける
function checkValue(number){
	var waveTag=$('#' + number).find("td:eq(2)")
	var waveVal=waveTag.text();
	if(waveVal.slice(0,1) == "(" && waveVal.slice(-1) == ")"){	//カッコ付きの場合はカッコを取る
		waveVal = waveVal.slice(1,-1);
	}
	var color=""; var textColor="black";
	if(waveVal >= 5){
		color="darkred";
		textColor="white";
	}else if(waveVal >= 4){
		color="orangered";
	}else if(waveVal >= 3){
		color="orange";
	}else if(waveVal >= 2){
		color="yellow";
	}else if(waveVal >= 1){
		color="blue";
		textColor="white"; // 青背景だったら黒文字は見えないんで
	}
	if(color!=""){ // 色がつけられるならそれをセット
		waveTag.css({"background-color": color, "color": textColor});
	}
}

</script>

<style type="text/css">
body{
	overflow: scrol;
}
span{
	display:inline-block;
}
#kaihoContents tr{
	height: 30px;
}
#kaihoContents tr.midashi{
  background-color: silver;
}
</style>

</head>


<body>
<input type="button"  value = "全て更新" name ="renewAll" onclick="renewAll();"/>
<table id="outTable">
<tr>
<td width="320px;">
	<div align="center"><input type="button"  value = "ナウファス波浪更新" name ="test3" onclick="nowphas();"/></div>
</td>
<td>
	<input type="button"  value = "灯台一覧表示（更新）" name ="test2" onclick="toudai();"/>&ensp;
	<input type="button"  value = "西部潮位表示（更新）" name ="test1w" onclick="chouiW();"/>
	<input type="button"  value = "東部潮位表示（更新）" name ="test1e" onclick="chouiE();"/>
	　　　<a href="./kaijou_bk20170330.html">以前のページ</a>&ensp;<a href="./kaijou2.html">以前のページ（観測所が南北に並んだ版）</a>
</td>
</tr>
<tr  valign="top">
<td width="320px;">
	<a href="http://www.mlit.go.jp/kowan/nowphas/" target="_blank">ナウファス</a>

	<table id="kaihoContents" border="1"></table>
	<br>
	<div align="center"><input type="button"  value = "河川+気象波浪更新" name ="test3" onclick="harodraw();"/></div>
	<a href="https://www.river.go.jp/" target="_blank">川の防災情報</a>
	<a href="https://www.jma.go.jp/bosai/wave/#code=47750&type=point" target="_blank">経ヶ岬</a>	
	<table id='harotable'></table>
	<br>
	<table border="1"><tr>
		<td>0～</td>
		<td style="background-color: blue; color: white;">1～</td>
		<td style="background-color: yellow;">2～</td>
		<td style="background-color: orange;">3～</td>
		<td style="background-color: orangered;">4～</td>
		<td style="background-color: darkred; color: white;">5～</td>
	</tr></table>
	ナウファスは表をマウスオーバーでグラフを表示、クリックで元ページに飛びます。<br>
</td>

<td>
	<div id="toudai">
		<div id="t1s" style="position:relative;left:0px;"></div>
		<div id="t2s" style="position:relative;left:200px;"></div>
		<div id="t3s" style="position:relative;left:400px;"></div>
		<div id="t1" style="position:relative;left:0px;top:10px;"></div>
		<div id="t2" style="position:relative;left:200px;top:10px;"></div>
		<div id="t3" style="position:relative;left:400px;top:10px;"></div>
		<div id="t4s" style="position:relative;left:0px;top:150px;"></div>
		<div id="t5s" style="position:relative;left:200px;top:150px;"></div>
		<div id="t6s" style="position:relative;left:400px;top:150px;"></div>
		<div id="t4" style="position:relative;left:0px;top:160px;"></div>
		<div id="t5" style="position:relative;left:200px;top:160px;"></div>
		<div id="t6" style="position:relative;left:400px;top:160px;"></div>
		<div id="t7s" style="position:relative;left:0px;top:300px;"></div>
		<div id="t8s" style="position:relative;left:200px;top:300px;"></div>
		<div id="t9s" style="position:relative;left:400px;top:300px;"></div>
		<div id="t7" style="position:relative;left:0px;top:310px;"></div>
		<div id="t8" style="position:relative;left:200px;top:310px;"></div>
		<div id="t9" style="position:relative;left:400px;top:310px;"></div>
		<div id="t10s" style="position:relative;left:0px;top:450px"></div>
		<div id="t10" style="position:relative;left:0px;top:460px;"></div>
	</div>
	<div id="gallery">
		<table id="chouiContents"></table>
	</div>
</td>
</tr>
</table>

<div id="kaihoErrorMessage"></div>
<br>

<!-- position:absolute; left: top: 等を指定することで、現状あるページにポップアップする -->
<!-- visibility:hidden としておくことで、通常は見えない仕組み -->
<div id="wavePict" style="position:absolute; z-index:10; left:310; top:100; visibility:hidden; background:white; border:solid"></div>
</body>
</html>
