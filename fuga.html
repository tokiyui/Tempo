<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>視程情報</title>
</head>
<body>
    <h1>視程情報</h1>
    <table id="visibilityTable" border="1">
        <thead>
            <tr>
                <th>地点番号</th>
                <th>地点名</th>
                <th>視程 (m)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>54232</td>
                <td>新潟</td>
                <td id="visibility_54232">取得中...</td>
            </tr>
            <tr>
                <td>54157</td>
                <td>相川</td>
                <td id="visibility_54157">取得中...</td>
            </tr>
            <tr>
                <td>54651</td>
                <td>高田</td>
                <td id="visibility_54651">取得中...</td>
            </tr>
            <tr>
                <td>55102</td>
                <td>富山</td>
                <td id="visibility_55102">取得中...</td>
            </tr>
            <tr>
                <td>55091</td>
                <td>伏木</td>
                <td id="visibility_55091">取得中...</td>
            </tr>
            <tr>
                <td>56052</td>
                <td>輪島</td>
                <td id="visibility_56052">取得中...</td>
            </tr>
            <tr>
                <td>56227</td>
                <td>金沢</td>
                <td id="visibility_56227">取得中...</td>
            </tr>
            <tr>
                <td>57066</td>
                <td>福井</td>
                <td id="visibility_57066">取得中...</td>
            </tr>
            <tr>
                <td>57248</td>
                <td>敦賀</td>
                <td id="visibility_57248">取得中...</td>
            </tr>
        </tbody>
    </table>

    <script>
        // 指定された地点番号の配列
        const points = [
            { code: '54232', name: '新潟' },
            { code: '54157', name: '相川' },
            { code: '54651', name: '高田' },
            { code: '55102', name: '富山' },
            { code: '55091', name: '伏木' },
            { code: '56052', name: '輪島' },
            { code: '56227', name: '金沢' },
            { code: '57066', name: '福井' },
            { code: '57248', name: '敦賀' }
        ];

        // 最新の観測時刻を取得する関数
        async function getLatestObservationTime() {
            const response = await fetch('https://www.jma.go.jp/bosai/amedas/data/latest_time.txt');
            const latestTimeText = await response.text();
            return latestTimeText.trim();  // 空白をトリム
        }

        // 視程データを取得する関数
        async function fetchVisibilityData() {
            const latestTime = await getLatestObservationTime();
            const url = `https://www.jma.go.jp/bosai/amedas/data/map/${latestTime}.json`;
            const response = await fetch(url);
            const data = await response.json();
            return data;
        }

        // 視程情報をテーブルに表示する関数
        async function displayVisibility() {
            const data = await fetchVisibilityData();

            points.forEach(point => {
                const visibility = data[point.code]?.['vis'] ?? 'データなし';
                document.getElementById(`visibility_${point.code}`).innerText = visibility;
            });
        }

        // ページが読み込まれたら視程情報を表示
        window.onload = displayVisibility;
    </script>
</body>
</html>
